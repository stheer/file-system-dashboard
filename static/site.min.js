var searchFilters=0,lastInput="",selectedFilters=[],CLIENT_ID=config.CLIENT_ID,API_KEY=config.API_KEY,DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],SCOPES="https://www.googleapis.com/auth/drive",parentFolder=" and 'shared-drives' in parents and '0AF0hsatILwu6Uk9PVA' in parents",FOLDER_ID="0AF0hsatILwu6Uk9PVA",SHARED_DRIVE="DC Office Drive",SHARED_DRIVE_ID="",fileNum=500,currentFolder="",currentFile="",removedFlag=!0,subFolderArray=[],parentArray=[],parentArrayIDs=[],clickedFolders=[],poppedFolders=[0],fileCounter=0,fileClicked=!1;function create2DArray(e){for(var l=[],r=0;r<e;r++)l[r]=[];return l}function fileType(e){var l="other";return e.search("google-apps.document")>0||"application/msword"==e?l=".doc":"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==e?l=".docx":e.search("spreadsheet")>0?l=".xlsx":e.search("spreadsheet")>0?l=".csv":e.search("google-apps.form")>0?l="google form":"application/pdf"==e?l=".pdf":e.search("presentation")>0?l=".pptx":"video/quicktime"==e?l=".mov":"image/jpeg"==e?l=".jpg":e.search("folder")>0&&(l="folder"),l}function removeLast(e,l){return e.splice(e.length-l,e.length),e}function handleClientLoad(){gapi.load("client:auth2",initClient)}function initClient(){gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}).then((function(){gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus),updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()),document.getElementById("login_button").onclick=handleAuthClick,document.getElementById("signout_button").onclick=handleSignoutClick}),(function(e){alert("Sign-in Error: "+e)}))}function updateSigninStatus(e,l){if(e){document.getElementById("login_button").style.display="none",document.getElementById("signout_button").style.display="block",googleUser=gapi.auth2.getAuthInstance().currentUser.get();gapi.auth.getToken();var r=googleUser.getAuthResponse().id_token;$("#folder-select").prop("disabled",!1),$.ajax("https://oauth2.googleapis.com/tokeninfo?id_token="+r,{type:"GET",success:function(e){$.ajax({type:"POST",url:"/validate",data:JSON.stringify({aud:e.aud,email:e.email,name:e.name}),dataType:"json",contentType:"application/json; charset=utf-8"})}}),gapi.client.drive.drives.list({}).execute((function(e){if(e.error)alert("Cannot Load Drives!");else{for(var l=e.result.drives,r=0;r<l.length;r++)l[r].name==SHARED_DRIVE&&(SHARED_DRIVE_ID=l[r].id);""==SHARED_DRIVE_ID&&(alert("Cannot access DC Office Drive! Please Either: \n \t1) Request shared drive access\n \tor\n \t2) Update 'Shared Drive Name' in Preferences"),$("#folder-select").attr("disabled",!0))}}))}else $("#folder-select").prop("disabled",!0),document.getElementById("login_button").style.display="block",document.getElementById("signout_button").style.display="none"}function handleAuthClick(e){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(e){$("#file-div").hide(),$("#file-options-buttons").hide(),$("#search-bottom").hide(),$("#library-bottom").hide(),$("#folder-select").val(""),$("#folder-select").attr("disabled",!0),gapi.auth2.getAuthInstance().signOut()}function appendPre(e){var l=document.createTextNode(e+"\n");pre.appendChild(l)}function noFilesMessage(){$(".file-header").hide(),$(".list").empty(),$("#file-list").html("<br><br><br>No files...")}function showSuccessAndEmpty(e){var l=e.charAt(0).toUpperCase()+e.slice(1);"folder"==e||"file"==e?($("#"+e+"-form").hide(),$("#success-message").append(l+" Succesfully Created!"),$("#close-"+e).prop("disabled",!1)):"files"==e?($("#file-form").hide(),$("#success-message").append(l+" Succesfully Created!"),$("#close-file").prop("disabled",!1)):"trash"==e?($("#trash-files").hide(),$("#success-message").append("Files Removed!")):($("#delete-folder").hide(),$("#success-message").append("Folder Removed!")),$("#success-message").show(),setTimeout((function(){$("#success-message").hide(),$("#success-message").empty(),$("#folder-name").val(""),$("#file-form").val("")}),2e3),$("#file-table").hide(),"trash"==e||"file"==e||"files"==e?listFiles(currentFolder,null,!1,null):$("#folder-select").trigger("change"),$("#file-table").show()}function listFiles(e,l,r,t){if(null==t){if($(".loadDisable").attr("disabled",!0),fileCounter=0,null!=l&&clickedFolders.push(l.currentTarget.id.split("-")[1]),0==parentArray.length)var s="trashed=false and mimeType='application/vnd.google-apps.folder' and name='"+e+"'";else s="trashed=false and mimeType='application/vnd.google-apps.folder' and name='"+e+"' and '"+parentArray[parentArray.length-1]+"' in parents";gapi.client.drive.files.list({pageSize:fileNum,q:s,fields:"nextPageToken, files(id)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(e){if(e.error)return alert("Error: "+e.error.message),void $(".loadDisable").attr("disabled",!1);var t=e.result.files[0];try{window.FOLDER_ID=t.id}catch(e){if(null!=l)return void setTimeout((function(){$("#folder-select").trigger("change")}),1500)}s="trashed=false and '"+window.FOLDER_ID+"' in parents",gapi.client.drive.files.list({pageSize:fileNum,q:s,fields:"nextPageToken, files(id, name, mimeType, modifiedTime)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(e){if(e.error)return alert("Error: "+e.error.message),void $(".loadDisable").attr("disabled",!1);var t=e.result.files,s=!0,i=!0;if(subFolderArray=[],t&&t.length>0){$(".list").empty(),$(".file-header").show();for(var a=0;a<t.length;a++){var o=t[a],n=o.name;if((d=o.name.substr(o.name.lastIndexOf("."))).length>1&&d.length<6)n=o.name.replace(d,"");else var d=fileType(o.mimeType);if("folder"==d)i=!1,subFolderArray.push(n);else{s=!1,fileCounter++,$("#file-list").append("<button value='"+o.id+"#"+o.mimeType+"' id=file-"+a+" class='file loadDisable'>"+n+"</button>"),$("#type-list").append("<div id=type-"+a+" class=type>"+d+"</div>");var c=new Date(Date.parse(o.modifiedTime));$("#date-list").append("<div id=date-"+a+" class=date>"+c.toLocaleDateString()+"</div>"),$("#delete-list").append("<input type='checkbox' class='trash-box loadDisable' id='box-"+a+"' value='"+o.id+"'>")}}i&null!=l&&($(l.currentTarget).addClass("click-error"),setTimeout((function(){$(l.currentTarget).removeClass("click-error")}),500),poppedFolders.push(clickedFolders.pop())),s&&noFilesMessage()}else noFilesMessage(),null!=l&&(poppedFolders.push(clickedFolders.pop()),$(l.currentTarget).addClass("click-error"),setTimeout((function(){$(l.currentTarget).removeClass("click-error")}),500));return r&&showSubFolders(),void $(".loadDisable").attr("disabled",!1)}))}))}else{s="trashed=false";for(var i=0;i<t.length;i++)if("Modified Date"==t[i][0])s=s+" and modifiedTime > '"+t[i][1]+"'";else if("File Contents"==t[i][0])s=s+" and fullText contains '"+t[i][1]+"'";else if("Folder"==t[i][0])s=s+" and '"+t[i][1]+"' in parents";else if("File Name"==t[i][0])s=s+" and name contains '"+t[i][1]+"'";else{if("File Type"!=t[i][0])continue;var a=JSON.parse(t[i][1]);for(j=0;j<a.length;j++)s=0==j?s+" and mimeType ='"+a[j]+"'":s+" or mimeType ='"+a[j]+"'"}gapi.client.drive.files.list({pageSize:fileNum,q:s,fields:"nextPageToken, files(id, name, mimeType, modifiedTime)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(e){if(e.error)return alert("Error: "+e.error.message),void $(".loadDisable").attr("disabled",!1);var t=e.result.files,s=!0,i=!0;if(subFolderArray=[],t&&t.length>0){$(".list").empty(),$(".file-header").show();for(var a=0;a<t.length;a++){var o=t[a],n=o.name;if((d=o.name.substr(o.name.lastIndexOf("."))).length>1&&d.length<6)n=o.name.replace(d,"");else var d=fileType(o.mimeType);if("folder"==d)i=!1,subFolderArray.push(n);else{s=!1,fileCounter++,$("#file-list").append("<button value='"+o.id+"#"+o.mimeType+"' id=file-"+a+" class='file loadDisable'>"+n+"</button>"),$("#type-list").append("<div id=type-"+a+" class=type>"+d+"</div>");var c=new Date(Date.parse(o.modifiedTime));$("#date-list").append("<div id=date-"+a+" class=date>"+c.toLocaleDateString()+"</div>"),$("#delete-list").append("<input type='checkbox' class='trash-box loadDisable' id='box-"+a+"' value='"+o.id+"'>")}}i&null!=l&&($(l.currentTarget).addClass("click-error"),setTimeout((function(){$(l.currentTarget).removeClass("click-error")}),500),poppedFolders.push(clickedFolders.pop())),s&&noFilesMessage()}else noFilesMessage(),null!=l&&(poppedFolders.push(clickedFolders.pop()),$(l.currentTarget).addClass("click-error"),setTimeout((function(){$(l.currentTarget).removeClass("click-error")}),500));return r&&showSubFolders(),void $(".loadDisable").attr("disabled",!1)}))}}function showSubFolders(e,l){for(var r=0;r<subFolderArray.length;r++)$("#sub-folder-list").append("<button value='"+subFolderArray[r]+"' class='sub-folder-link loadDisable' id='link-"+(parentArray.length+1)+r+"' style='margin-left:"+2*(parentArray.length+1)+"%'>/"+subFolderArray[r]+"</button>"),$("#sub-folder-trash").append("<input type='checkbox' class='folder-trash-box loadDisable visibility' id='folder-box-"+(parentArray.length+1)+r+"' value='"+subFolderArray[r]+"'>"),parentArrayIDs.push("link-"+(parentArray.length+1)+r)}function addFileButtons(e,l,r,t){fileClicked=!0,""!=currentFile&&clickedFileButton(),currentFile=e.currentTarget.id.split("-")[1],$(e.currentTarget).addClass("clicked"),fileCounter>1&&($("#space-entry").append(" <br> "),$("#move-down-file").append($("#file-"+currentFile)),$("#move-down-type").append($("#type-"+currentFile)),$("#move-down-date").append($("#date-"+currentFile)),$("#move-down-delete").append($("#box-"+currentFile))),$(".trash-box").prop("disabled",!0),$(".folder-trash-box").prop("disabled",!0),$("#file-options-preview").prop("value",l),$("#file-options-download").prop("value",r),$("#file-options-edit").prop("value",t),$("#file-options-buttons").show()}function clickedFileButton(){fileCounter>1&&($("#space-entry").empty(),$("#file-list").append($("#file-"+currentFile)),$("#type-list").append($("#type-"+currentFile)),$("#date-list").append($("#date-"+currentFile)),$("#delete-list").append($("#box-"+currentFile))),$(".file").each((function(){$(this).hasClass("clicked")&&$(this).removeClass("clicked")})),$(".trash-box").prop("disabled",!1),$(".folder-trash-box").prop("disabled",!1),$("#file-options-buttons").hide()}function insertFileIntoFolder(e){var l=gapi.auth.getToken().access_token;gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/"+window.FOLDER_ID+"/children",method:"POST",headers:{Authorization:"Bearer "+l},params:{supportsAllDrives:!0},body:{id:e}}).execute((function(e){e.error&&alert("File Could Not Be Added to Folder!")}))}function updateFileLocation(e){var l=gapi.auth.getToken().access_token;gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/"+e+"?addParents="+window.FOLDER_ID+"?removeParents=root",method:"PUT",headers:{Authorization:"Bearer "+l},params:{supportsAllDrives:!0}}).execute((function(e){e.error&&alert("File Could Not Be Added to Folder!")}))}function moveFileToTrash(e){var l=gapi.auth.getToken().access_token;gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/"+e+"/trash",method:"POST",headers:{Authorization:"Bearer "+l},params:{supportsAllDrives:!0}}).execute((function(e){e.error?alert("File Could Not Be Removed!"):console.log("file removed")}))}function moveFolderToTrash(e){if(0==parentArray.length)var l="trashed=false and mimeType='application/vnd.google-apps.folder' and name='"+e+"'";else l="trashed=false and mimeType='application/vnd.google-apps.folder' and name='"+e+"' and '"+parentArray[parentArray.length-1]+"' in parents";gapi.client.drive.files.list({pageSize:fileNum,q:l,fields:"nextPageToken, files(id)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(e){e.error?alert("Folder Could Not Be Removed!"):moveFileToTrash(e.result.files[0].id)}))}function showLoad(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var l=100*(e.loaded/e.total-1e-4);console.log(l),$("#upload-progress").prop("aria-valuenow",String(l)),$("#upload-progress").prop("style","width: "+String(l)+"%"),$("#upload-progress").html(String(l.toFixed(2))+"%")}}),!1),e}function removeLast(e,l){return e.splice(e.length-l,e.length),e}function uploadFile(e,l){return uploadRequest(e).then(showLoad())}function uploadRequest(e){return new Promise((l,r)=>{e.size<=0&&(e=new Blob([" "],{type:e.type||"application/octet-stream"})),1==fileClicked&&clickedFileButton();var t=gapi.auth.getToken().access_token,s=new FileReader;s.readAsBinaryString(e),s.onload=function(i){var a={name:e.name,mimeType:e.type||"application/octet-stream",kind:"drive#file",parents:[window.FOLDER_ID]},o=btoa(s.result),n="\r\n--file-upload\r\nContent-Type: application/json; \r\n\r\n"+JSON.stringify(a)+"\r\n--file-upload\r\nContent-Type: "+e.type+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+o+"\r\n--file-upload--";gapi.client.request({path:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",method:"POST",headers:{"Content-Type":'multipart/related; boundary="file-upload"',Authorization:"Bearer "+t},params:{supportsAllDrives:!0},body:n}).execute((function(e){e.error?(alert("Error: "+e.error.message),r("error")):l("success")}))}})}async function fileUploadLoop(){files=$("#file-select").prop("files");for(let l=0;l<files.length;l++){var e=files[l];console.log(e),await uploadFile(e)}$("#success-message").empty(),1==files.length?showSuccessAndEmpty("file"):showSuccessAndEmpty("files")}function checkBlankSearches(){var e=0;$(".search").each((function(){(""==$(this).val()|null==$(this).val())&!$(this).is(":hidden")&&e++})),0==e?$("#execute-query").prop("disabled",!1):$("#execute-query").prop("disabled",!0)}function getAllFolders(e){gapi.client.drive.files.list({pageSize:fileNum,q:"trashed=false and mimeType='application/vnd.google-apps.folder'",fields:"nextPageToken, files(id, name)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(l){if(!l.error){for(var r=l.result.files,t=create2DArray(r.length),s=0;s<r.length;s++){var i=r[s];t[s][0]=i.id,t[s][1]=i.name}t.sort((function(e,l){return e[1]>l[1]?1:e[1]<l[1]?-1:0}));for(s=0;s<t.length;s++)$("#search"+e).append("<option value='"+t[s][0]+"'>"+t[s][1]+"</option>")}}))}function getAllFileTypes(e){var l,r={};gapi.client.drive.files.list({pageSize:fileNum,q:"trashed=false and mimeType!='application/vnd.google-apps.folder'",fields:"nextPageToken, files(id, name, mimeType)",corpora:"drive",driveId:SHARED_DRIVE_ID,supportsAllDrives:!0,includeItemsFromAllDrives:!0}).execute((function(t){if(!t.error){for(var s=t.result.files,i=0;i<s.length;i++){var a=s[i];if(!((o=a.name.substr(a.name.lastIndexOf(".")).toLowerCase()).length>1&&o.length<6))var o=fileType(a.mimeType);"other"!=o&&(null!=r[o]?((l=r[o]).add(a.mimeType),r[o]=l):(l=new Set).add(a.mimeType),l.add(a.mimeType),r[o]=l)}var n,d=create2DArray(Object.keys(r).length);i=0;for(var c in r){l=r[c],n=Array.from(l),d[i][0]=c;for(var p=0;p<n.length;p++)d[i][p+1]=n[p];i++}d.sort((function(e,l){return e[0]>l[0]?1:e[0]<l[0]?-1:0}));for(i=0;i<d.length;i++)n=(n=d[i]).slice(1),$("#search"+e).append("<option value='"+JSON.stringify(n)+"'>"+d[i][0]+"</option>")}}))}$(document).ready(()=>{$("#home-button").on("click",()=>{window.location.href="/"}),$("#library-button").on("click",()=>{window.location.href="/library"}),$("#notes-button").on("click",()=>{window.location.href="/notes"}),$("#create-folder").on("click",()=>{$(".close").click(),$("#folder-form").show()}),$("#upload-file").on("click",()=>{$(".close").click(),$("#file-form").show()}),$(".close").on("click",e=>{$(".close").parent().hide(),$(".input").val(""),$("button.input-button").prop("disabled",!0)}),$(".input").on("input",()=>{$("button.input-button").prop("disabled",!1)}),$("#search-filter-options").on("input",".file-search",e=>{searchFilters<5?($("#add-search-filter").prop("disabled",!1),lastInput=e.currentTarget.value):$("#add-search-filter").prop("disabled",!0)}),$("#add-search-filter").on("click",()=>{if("Modified Date"==lastInput?$("#search-query").append("<input type='date' id='search"+searchFilters+"' class='search hide'>"):"Folder"==lastInput?($("#search-query").append("<select id='search"+searchFilters+"' class='search hide'>"),$("#search"+searchFilters).append("<option value='' selected disabled hidden></option>"),getAllFolders(searchFilters)):"File Type"==lastInput?($("#search-query").append("<select id='search"+searchFilters+"' class='search hide'>"),$("#search"+searchFilters).append("<option value='' selected disabled hidden></option>"),getAllFileTypes(searchFilters)):$("#search-query").append("<input type='text' id='search"+searchFilters+"' class='search hide'>"),$("#search"+searchFilters).prop("placeholder",lastInput),$("#file-search"+searchFilters).attr("disabled",!0),selectedFilters.push(lastInput),$("#search"+searchFilters).css({display:"block","margin-top":"5px"}),$("#search"+searchFilters).show(),searchFilters<4){$("#delete-filter"+searchFilters).remove(),searchFilters++,$("#search-filter-options").append("<div id='search-dropdown"+searchFilters+"' class='search-dropdown additional-filter'></div>"),$("#search-dropdown"+searchFilters).append("<label class='label' for='file-search"+searchFilters+"'>And </label>"),$("#file-search0").clone().attr({id:"file-search"+searchFilters,class:"file-search child-level"}).appendTo("#search-dropdown"+searchFilters),$("#file-search"+searchFilters).attr("disabled",!1);for(var e=0;e<selectedFilters.length;e++)$("#file-search"+searchFilters+" option[value='"+selectedFilters[e]+"']").remove();$("#search-dropdown"+searchFilters).append("<button class='delete-filter' id='delete-filter"+searchFilters+"' value='search-dropdown"+searchFilters+"'>x</button>"),$("#add-search-filter").prop("disabled",!0),checkBlankSearches()}else $("#add-search-filter").attr("disabled",!0)}),$("#search-filter-options").on("click",".delete-filter",e=>{$("#add-search-filter").prop("disabled",!0);var l=e.currentTarget.id,r=searchFilters-1;1==$("#file-search"+l.charAt(l.length-1)).prop("disabled")?(removeLast(selectedFilters,2),$("#search"+searchFilters).remove(),$("#search"+r).remove()):(selectedFilters.pop(),$("#search"+r).remove()),searchFilters--,checkBlankSearches(),searchFilters>0?$("#search-dropdown"+searchFilters).append("<button class='delete-filter' id='delete-filter"+searchFilters+"' value='search-dropdown"+searchFilters+"'>x</button>"):($("#execute-query").prop("disabled",!0),selectedFilters=[]),$("#file-search"+searchFilters).attr("disabled",!1),$("#file-search"+searchFilters).val(""),$("#"+e.currentTarget.value).remove()}),$("#search-filter-text").on("input",".search",()=>{checkBlankSearches()}),$("#execute-query").on("click",()=>{var e=create2DArray(5);$("#query-results-sql").empty(),$("#query-results-sql").append("<span class='SQL-select'>SELECT </span>* <span class='SQL-select'>FROM </span><span class='SQL-db'>google.drive </span><br><span class='SQL-select'>&nbsp &nbspWHERE </span>");let l=0,r=0;$(".search").each((function(){e[l][0]=selectedFilters[l],e[l][1]=$(this).val(),0!=l&&$("#query-results-sql").append("<span class='SQL-select'> &nbsp &nbspAND </span>"),r="Folder"==selectedFilters[l]|"File Type"==selectedFilters[l]?$("#"+this.id+" option:selected").text():$(this).val(),"Modified Date"==selectedFilters[l]?$("#query-results-sql").append("<span class='SQL-filter'>"+selectedFilters[l]+"<span/><span class='SQL-select'> > </span><span class='SQL-value'>"+r+"</span><br>"):"File Name"==selectedFilters[l]?$("#query-results-sql").append("<span class='SQL-filter'>"+selectedFilters[l]+"<span/><span class='SQL-select'> LIKE </span><span class='SQL-value'>"+r+"%</span><br>"):"File Contents"==selectedFilters[l]?$("#query-results-sql").append("<span class='SQL-filter'>"+selectedFilters[l]+"<span/><span class='SQL-select'> LIKE </span><span class='SQL-value'>%"+r+"%</span><br>"):$("#query-results-sql").append("<span class='SQL-filter'>"+selectedFilters[l]+"<span/><span class='SQL-select'> = </span><span class='SQL-value'>"+r+"</span><br>"),l++})),listFiles(null,null,!1,e),$("#file-div").show()}),$("#folder-select").on("change",e=>{var l=$("#folder-select").val();if("Search"==l){$("#library-bottom").hide(),$(".list").empty(),$("#file-div").hide(),$("#file-table").css({"margin-left":"0px"}),$("#execute-query").prop("disabled",!0),$("#query-results-sql").empty();for(var r=0;r<searchFilters+1;r++)0!=r&&($("#search-dropdown"+r).remove(),$("#search"+r).remove()),$("#search"+r).remove();selectedFilters=[],searchFilters=0,$("#file-search0").prop("disabled",!1),$("#file-search0").val(""),$("#search-bottom").show()}else $("#search-bottom").hide(),removedFlag=!0,parentArray=[],parentArrayIDs=["link-root"],clickedFolders=[],poppedFolders=[0],currentFolder=$("#folder-select").val(),$(".create-buttons").attr("disabled",!1),1==fileClicked&&clickedFileButton(),$("#sub-folder-list").empty(),$("#sub-folder-trash").empty(),$(".form").hide(),$("#library-bottom").show(),$("#file-table").css({"margin-left":"8%"}),$("#file-div").show(),$("#folder-header").html("Add "+l+" Sub-Folder"),$("#file-header").html("Upload "+l+" File"),$("#trash-files").hide(),$("#delete-folder").hide(),$("#sub-folder-list").append("<button value='/' class='sub-folder-link loadDisable clicked' id='link-root'>/</button>"),$("#sub-folder-trash").append("<input type='checkbox' class='visibility' id='folder-box-root' value=''>"),listFiles($("#folder-select").val(),e,!0,null)}),$("#add-folder").on("click",()=>{if(""==$(".input").val())alert("Please enter a folder name");else{1==fileClicked&&clickedFileButton(),$("#add-folder").prop("disabled",!0),$("#close-folder").prop("disabled",!0),showLoad();var e=gapi.auth.getToken().access_token;gapi.client.request({path:"/drive/v3/files/",method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},params:{supportsAllDrives:!0},body:{name:$("#folder-name").val(),mimeType:"application/vnd.google-apps.folder",kind:"drive#file",parents:[window.FOLDER_ID]}}).execute((function(e){e.error?alert("Error: "+e.error.message):showSuccessAndEmpty("folder")}))}}),$("#upload").on("click",()=>{$("#upload").prop("disabled",!0),$("#close-file").prop("disabled",!0),fileUploadLoop()}),$("#file-list").on("click",".file",e=>{var l=e.currentTarget.value.split("#")[0],r=gapi.auth.getToken().access_token,t=e.currentTarget.value.split("#")[1];gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/"+l+"?mimeType="+t+"?alt=media",headers:{Authorization:"Bearer "+r},params:{supportsAllDrives:!0}}).execute((function(l,r){l.error?alert("Error: "+l.error.message):0!=l?addFileButtons(e,l.embedLink,l.webContentLink,l.alternateLink):console.log("GetFile Error! Raw resp: "+JSON.parse(r))}))}),$("#file-options-buttons").on("click","#file-options-preview",e=>{window.open(e.currentTarget.value,"_blank"),clickedFileButton()}),$("#file-options-buttons").on("click","#file-options-download",e=>{window.open(e.currentTarget.value,"_blank"),clickedFileButton()}),$("#file-options-buttons").on("click","#file-options-edit",e=>{window.open(e.currentTarget.value,"_blank"),clickedFileButton()}),$("#file-options-buttons").on("click","#file-options-close",e=>{clickedFileButton(),fileClicked=!1}),$("#delete-list").on("change",":checkbox",()=>{0==document.querySelectorAll("input:checked").length?($(".trash-box").addClass("loadDisable"),$(".loadDisable").attr("disabled",!1),$(".folder-trash-box").prop("disabled",!1),$("#trash-files").hide()):($(".trash-box").removeClass("loadDisable"),$(".loadDisable").attr("disabled",!0),$(".folder-trash-box").prop("disabled",!0),$("#trash-files").show())}),$("#sub-folder-trash").on("change",":checkbox",()=>{0==document.querySelectorAll("input:checked").length?($(".folder-trash-box").addClass("loadDisable"),$(".loadDisable").attr("disabled",!1),$(".trash-box").prop("disabled",!1),$("#delete-folder").hide()):($(".folder-trash-box").removeClass("loadDisable"),$(".loadDisable").attr("disabled",!0),$(".trash-box").prop("disabled",!0),$("#delete-folder").show())}),$("#trash-files").on("click",()=>{$(".trash-box").each((function(){this.checked&&moveFileToTrash(this.value)})),gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/",method:"GET",params:{supportsAllDrives:!0}}).execute((function(e){e.error?alert("Error: "+e.error.message):showSuccessAndEmpty("trash")})),$(".folder-trash-box").prop("disabled",!0)}),$("#delete-folder").on("click",()=>{$(".folder-trash-box").each((function(){this.checked&&moveFolderToTrash(this.value)})),gapi.client.request({path:"https://www.googleapis.com/drive/v2/files/",method:"GET",params:{supportsAllDrives:!0}}).execute((function(e){e.error?alert("Error: "+e.error.message):showSuccessAndEmpty("trash-sub-folder")}))}),$("#sub-folder-list").on("click",".sub-folder-link",e=>{var l=e.currentTarget.value,r=e.currentTarget.id;if(currentFolder=l,1==fileClicked&&clickedFileButton(),"link-root"!=r)if($(".sub-folder-link").each((function(){$(this).hasClass("clicked")&&($(this).removeClass("clicked"),$("#folder-box-"+this.id.split("-")[1]).addClass("visibility"))})),$(e.currentTarget).addClass("clicked"),$("#folder-box-"+r.split("-")[1]).removeClass("visibility"),!clickedFolders.includes(r.split("-")[1])&(!(r.split("-")[1][0]<=clickedFolders[clickedFolders.length-1][0])|"s"==clickedFolders[clickedFolders.length-1][0]))!poppedFolders.includes(r.split("-")[1])&removedFlag&r.split("-")[1][0]!=poppedFolders[poppedFolders.length-1][0]&&parentArray.push(window.FOLDER_ID),listFiles(l,e,!0,null),removedFlag=!0;else if(clickedFolders.includes(r.split("-")[1])){removeLast(parentArray,parentArray.length-r.split("-")[1][0]);for(s=parentArrayIDs.splice(parentArrayIDs.indexOf(r)+1,parentArrayIDs.length).filter(e=>e.split("-")[1][0]>r.split("-")[1][0]&"link-root"!=e),i=0;i<s.length;i++)$("#"+s[i]).remove(),$("#folder-box-"+s[i].split("-")[1]).remove(),index=clickedFolders.indexOf(s[i].split("-")[1]),-1!=index&&clickedFolders.splice(index,1);poppedFolders=[0],listFiles(l,e,!1,null),removeLast(clickedFolders,2),removedFlag=!1}else{removeLast(parentArray,parentArray.length-r.split("-")[1][0]);for(var t=parseInt(r.split("-")[1][0])+1,s=parentArrayIDs.splice(parentArrayIDs.indexOf("link-"+t+"0"),parentArrayIDs.length).filter(e=>e.split("-")[1][0]>r.split("-")[1][0]&"link-root"!=e),i=0;i<s.length;i++)$("#"+s[i]).remove(),$("#folder-box-"+s[i].split("-")[1]).remove(),index=clickedFolders.indexOf(s[i].split("-")[1]),-1!=index&&clickedFolders.splice(index,1);removeLast(clickedFolders,1),poppedFolders=[0],listFiles(l,e,!0,null),removedFlag=!0}else $("#folder-select").trigger("change")})});